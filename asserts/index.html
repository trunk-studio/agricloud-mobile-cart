<!doctype html>
<html class="no-js" lang="en-US">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, minimal-ui">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<title>雲端農場：快易購</title>
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.4/jquery.mobile-1.4.4.min.css" />
<link rel="apple-touch-startup-image" href="img/splash.png" />
<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="http://code.jquery.com/mobile/1.4.4/jquery.mobile-1.4.4.min.js"></script>
<link rel="stylesheet" type="text/css" href="style.css" />
<style type="text/css">#splash{background-image: url(splash.png)}</style>
</head>
<body>
<div data-role="page" data-theme="b" id="splash">
	<div class="splash">
	<!--
		<div class="logoframe">
			<h1>AgriCloud</h1>
			<p>新鮮水果快易購</p>
		</div>
		-->
	</div>
</div>
<div data-role="page" data-theme="b" id="home">
	<div data-role="header" data-position="fixed" data-theme="b">
		<a id="btnGoToDashboard" href="#home" data-icon="home" data-iconpos="notext">回到首頁</a>
		<h1>商品</h1>
	</div>
	<div data-role="main" class="ui-content">
		<img id='product_image' src="about:blank" alt="product" />
		<h3 id='product_name'></h3>
		<p id='product_descript'></p>
		<p>庫存箱數: <span id='product_stockQuantity'>0</span></p>
		<p>單價: <span id='product_price'>0</span></p>
		<fieldset data-role="controlgroup" data-type="horizontal">
	        <label for="select-more-1a" class="ui-hidden-accessible">More</label>
	        <select name="order_quantity" id="order_quantity">
	            <option value="">數量</option>
	        </select>
	        <a href="#purchase" id='purchaseButton' class="ui-btn ui-corner-all">進行購買</a>

	    </fieldset>
	</div>
	<div data-role="footer" data-position="fixed">
		<div data-role="navbar">
			<ul>
				<li><a href="#home" data-action="announce" data-icon="home">商品訂購</a></li>
				<li><a href="#orderQuery" data-action="contact" data-icon="star">訂單查詢</a></li>
				<li><a href="#home" data-action="information" data-icon="info">履歷</a></li>
				<li><a href="#contact" data-action="about" data-icon="grid">聯絡</a></li>
			</ul>
		</div><!-- /navbar -->
	</div>
</div>
<div data-role="page" data-theme="b" id="orderQuery">
	<div data-role="header" data-position="fixed" data-theme="b">
		<a href="#home" data-icon="back" data-iconpos="notext">返回</a>
		<h1>訂單查詢</h1>
	</div>
	<div data-role="content">
		<form id='orderStatusQueryForm' method="post" action="/order/status">
			<div data-role="fieldcontain">
	         <label for="email">Email:</label>
	         <input type="email" name="email" id="email" value="buyer@gmail.com" />
			</div>
			<div data-role="fieldcontain">
	         <label for="orderId">Number:</label>
	         <input type="number" name="orderId" id="orderId" value="1111" />
			</div>
			<fieldset class="ui-grid-a">
				<div class="ui-block-a"><button type="submit" data-theme="d">Cancel</button></div>
				<div class="ui-block-b"><button type="submit" data-theme="a">Submit</button></div>
	    </fieldset>
		</form>
	</div>
	<div data-role="footer" data-position="fixed">
		<div data-role="navbar">
			<ul>
				<li><a href="#home" data-action="announce" data-icon="home">商品</a></li>
			</ul>
		</div><!-- /navbar -->
	</div>
</div>

<div data-role="page" data-theme="b" id="orderStatus">
	<div data-role="header" data-position="fixed" data-theme="b">
		<a href="#order" data-icon="back" data-iconpos="notext">返回</a>
		<h1>訂單狀態</h1>
	</div>
	<div data-role="orderStatus">

		<h1>訂單資訊</h1>

		<div data-role="fieldcontain">
			<label for="orderStatus_quantity">訂單數量:</label>
			<span id="orderStatus_quantity"/>
		</div>

		<div data-role="fieldcontain">
			<label for="orderStatus_id">訂單編號:</label>
			<span id="orderStatus_id"/>
		</div>

		<h2>訂購者資訊</h2>

		<div data-role="fieldcontain">
			<label for="orderStatus_user_username">訂購者姓名:</label>
			<span id="orderStatus_user_username"/>
		</div>

		<div data-role="fieldcontain">
			<label for="orderStatus_user_email">email:</label>
			<span id="orderStatus_user_email"/>
		</div>

		<div data-role="fieldcontain">
			<label for="orderStatus_user_mobile">電話:</label>
			<span id="orderStatus_user_mobile"/>
		</div>

		<div data-role="fieldcontain">
			<label for="orderStatus_user_address">地址:</label>
			<span id="orderStatus_user_address"/>
		</div>

		<h2>匯款資訊</h2>

		<div data-role="fieldcontain">
			<label for="orderStatus_bank_id">銀行代號:</label>
			<span id="orderStatus_bank_id"/>
		</div>

		<div data-role="fieldcontain">
			<label for="orderStatus_bank_accountId">匯款帳戶:</label>
			<span id="orderStatus_bank_accountId"/>
		</div>

		<h2>收件者資訊</h2>


		<div data-role="fieldcontain">
			<label for="orderStatus_shipment_username">收件者姓名:</label>
			<span id="orderStatus_shipment_username"/>
		</div>

		<div data-role="fieldcontain">
			<label for="orderStatus_shipment_email">email:</label>
			<span id="orderStatus_shipment_email"/>
		</div>

		<div data-role="fieldcontain">
			<label for="orderStatus_shipment_mobile">電話:</label>
			<span id="orderStatus_shipment_mobile"/>
		</div>

		<div data-role="fieldcontain">
			<label for="orderStatus_shipment_address">地址:</label>
			<span id="orderStatus_shipment_address"/>
		</div>



	</div>
</div>

<div data-role="page" data-theme="b" id="purchase">
	<div data-role="header" data-position="fixed" data-theme="b">
		<a href="#home" data-icon="back" data-iconpos="notext">返回</a>
		<h1>訂單建立</h1>
	</div>
	<div data-role="purchase">
		<form id='purchaseForm' method="post" action="/order">
			<div data-role="fieldcontain">
				<label for="order[quantity]">訂購數量</label>
				<input type="number" name="order[quantity]" id='order[quantity]' value="" readonly />
				<input type="hidden" name="order[product][id]" id='order[product][id]' value="1" />
			</div>

			<h2>訂購者資訊</h2>
			<div data-role="fieldcontain">
				<label for="order[user][username]">訂購者姓名:</label>
				<input type="text" name="order[user][username]" id='order[user][username]' value="王大明" />
			</div>

			<div data-role="fieldcontain">
				<label for="order[user][email]">email:</label>
				<input type="email" name="order[user][email]" id='order[user][email]' value="new@gmail.com" />
			</div>

			<div data-role="fieldcontain">
				<label for="order[user][mobile]">電話:</label>
				<input type="number" name="order[user][mobile]" id='order[user][mobile]' value="0911111111" />
			</div>

			<div data-role="fieldcontain">
				<label for="order[user][address]">地址:</label>
				<input type="text" name="order[user][address]" id='order[user][address]' value="台北市" />
			</div>

			<h2>收件者資訊</h2>
			<div data-role="fieldcontain">
				<label for="order[shipment][username]">收件者姓名:</label>
				<input type="text" name="order[shipment][username]" id='order[shipment][username]' value="王大明" />
			</div>

			<div data-role="fieldcontain">
				<label for="order[shipment][email]">email:</label>
				<input type="email" name="order[shipment][email]" id='order[shipment][email]' value="new@gmail.com" />
			</div>

			<div data-role="fieldcontain">
				<label for="order[shipment][mobile]">電話:</label>
				<input type="number" name="order[shipment][mobile]" id='order[shipment][mobile]' value="0911111111" />
			</div>

			<div data-role="fieldcontain">
				<label for="order[shipment][address]">地址:</label>
				<input type="text" name="order[shipment][address]" id='order[shipment][address]' value="台北市" />
			</div>
			<fieldset class="ui-grid-a">
				<div class="ui-block-a"><button type="submit" data-theme="d">Cancel</button></div>
				<div class="ui-block-b"><button type="submit" data-theme="a">Submit</button></div>
			</fieldset>
		</form>
	</div>
</div>

<div data-role="page" data-theme="b" id="purchaseResult">
	<div data-role="header" data-position="fixed" data-theme="b">
		<a href="#home" data-icon="back" data-iconpos="notext">返回</a>
		<h1>訂單建立完成</h1>
	</div>
	<div data-role="purchaseResult">
		<div data-role="fieldcontain">
			<label for="purchaseResult_orderId">訂單編號</label>
			<span id="purchaseResult_orderId"/>
		</div>

		<div data-role="fieldcontain">
			<label for="purchaseResult_orderQuantity">購買數量</label>
			<span id="purchaseResult_orderQuantity"/>
		</div>

		<div data-role="fieldcontain">
			<label for="purchaseResult_productPrice">單價</label>
			<span id="purchaseResult_productPrice"/>
		</div>

		<div data-role="fieldcontain">
			<label for="purchaseResult_orderPrice">總金額</label>
			<span id="purchaseResult_orderPrice"/>
		</div>

		<h2>匯款資訊</h2>

		<div data-role="fieldcontain">
			<label for="purchaseResult_bank_id">銀行代號</label>
			<span id="purchaseResult_bank_id"/>
		</div>

		<div data-role="fieldcontain">
			<label for="purchaseResult_bank_accountId">匯款帳戶</label>
			<span id="purchaseResult_bank_accountId"/>
		</div>


	</div>
</div>


<script type="text/javascript">


$(function() {

	// Cache all pages
	//cacheAllPages();
	$.get("/product/1", function(data, status){

		var product = data.product;

		$('#product_stockQuantity').text(product.stockQuantity);
		$('#product_name').text(product.name);
		$('#product_descript').text(product.descript);
		$('#product_price').text(product.price);
		$('#product_image').attr("src", product.image);

		for (var i = 1; i < product.stockQuantity+1; i++) {
			$('#order_quantity')
          .append($("<option></option>")
          .attr("value",i)
          .text(i + ' 箱'));
		}
	});


	$("#orderStatusQueryForm").submit(function(e)
	{
    var postData = $(this).serializeArray();
    var formURL = $(this).attr("action");
    $.ajax(
    {
      url : formURL,
      type: "POST",
      data : postData,
      success:function(data, textStatus, jqXHR)
      {
        var orderStatus = JSON.parse(data);
				$('#orderStatus_quantity').text(orderStatus.order.quantity);
				$('#orderStatus_id').text(orderStatus.order.id);
				$('#orderStatus_user_username').text(orderStatus.order.User.username);
				$('#orderStatus_user_email').text(orderStatus.order.User.email);
				$('#orderStatus_user_mobile').text(orderStatus.order.User.mobile);
				$('#orderStatus_user_address').text(orderStatus.order.User.address);

				$('#orderStatus_shipment_username').text(orderStatus.order.Shipment.username);
				$('#orderStatus_shipment_email').text(orderStatus.order.Shipment.email);
				$('#orderStatus_shipment_mobile').text(orderStatus.order.Shipment.mobile);
				$('#orderStatus_shipment_address').text(orderStatus.order.Shipment.address);

				$('#orderStatus_bank_accountId').text(orderStatus.bank.bank.accountId);
				$('#orderStatus_bank_id').text(orderStatus.bank.bank.id);

				window.location.assign("/index.html#orderStatus");


      },
      error: function(jqXHR, textStatus, errorThrown)
      {
        //if fails
      }
    });
    e.preventDefault(); //STOP default action
	});

	$("#purchaseButton").bind("click", function() {
	  var orderQuantity = $("#order_quantity").val();
		console.log('orderQuantity', orderQuantity);
		$("input[name='order[quantity]']").val(orderQuantity);
	});

	$("#purchaseForm").submit(function(e)
	{
    var postData = $(this).serializeArray();
    var formURL = $(this).attr("action");
    $.ajax(
    {
      url : formURL,
      type: "POST",
      data : postData,
      success:function(data, textStatus, jqXHR)
      {
        var purchaseResult = JSON.parse(data);
				var product = purchaseResult.order.product;
				$('#purchaseResult_orderId').text(purchaseResult.order.id);
				$('#purchaseResult_orderQuantity').text(purchaseResult.order.quantity);
				$('#purchaseResult_productPrice').text(product.price);

				var orderPrice =
					parseInt(purchaseResult.order.quantity, 10) * parseInt(product.price, 10);

				$('#purchaseResult_orderPrice').text(orderPrice);
				$('#purchaseResult_bank_id').text(purchaseResult.bank.id);
				$('#purchaseResult_bank_accountId').text(purchaseResult.bank.accountId);

				window.location.assign("/index.html#purchaseResult");


      },
      error: function(jqXHR, textStatus, errorThrown)
      {
        //if fails
      }
    });
    e.preventDefault(); //STOP default action
	});



	if (true /* window.navigator.standalone == true */) {
		$('#splash').on('swipe', hideSplash);
		setTimeout(hideSplash, 3000);
	}


	$( "a" ).loader({ defaults: true });

	$( document ).ajaxStart(function() {
		$.mobile.loading( "show", {
			text: "Loading...",
			textVisible: true,
			theme: "b",
			html: ""
		});
	});
	$( document ).ajaxComplete(function() {
		$.mobile.loading( "hide" );
	});
	$( document ).ajaxStop(function() {
		$.mobile.loading( "hide" );
	});

});

function loadPage(pagename) {
	$.get('wp-json/posts?type[]=page&filter[pagename]='+pagename, function(data) {
		$('#home h1').text(data[0].title);
		var container = $('#home div[data-role=main]');
		container.html(data[0].content);
		container.find('a[href$=".jpg"], a[href$=".jpeg"], a[href$=".png"], a[href$=".gif"]').has('img').each(function() {
			var popupId = 'popup' + new Date().getTime();
			var imgSrc = $(this).attr('href');
			$(this).find('img')./*removeAttr('width').removeAttr('height').removeClass().*/addClass('popphoto');
			$(this).attr('data-rel', 'popup').attr('data-position-to', 'window').attr('data-transition', 'fade');
			$(this).attr('href', '#'+po.upId);
			var popup = $('<div data-role="popup" id="'+popupId+'" data-overlay-theme="b" data-theme="b" data-corners="false"><a href="#" data-rel="back" data-role="button" data-theme="b" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a><img class="popphoto" src="'+imgSrc+'" style="max-height:512px;" /></div>');
			popup.insertAfter($(this));
		});

		//console.log($('a[href$=jpg]'));
		container.trigger('create');
	});
}
function retrieveData() {
	$.get('wp-json/posts?filter[cat]=announce', function(data) {
		var ul = $('<ul/>').data('role', 'listview');
		for (var i = 0; i < data.length; i++) {
			var postDate = new Date(data[i].date);
			var dateStr = postDate.getMonth()+'/'+postDate.getDate();
			var li = $('<li/>');
			var a = $('<a/>');
			a.click(function() {
				$('#viewer h1').text($(this).children('h2').text());
				$('#viewer div[data-role=content]').html($(this).children('.content').html());
			});
			a.attr('href', '#viewer');
			if (data[i].featured_image && data[i].featured_image.source) {
				a.append('<img src="'+data[i].featured_image.source+'" />');
			}
			a.append($('<h2/>').text(data[i].title));
			a.append($('<div/>').html(data[i].excerpt));
			a.append($('<div/>').html(data[i].content).addClass('content').hide());
			//a.append($('<p/>').append(data[i].author.name));
			a.append($('<p class="ui-li-aside">').text(dateStr));
			li.append(a);
			ul.append(li);
		}
		$('#home div[data-role=main]').empty().append(ul);
		ul.listview();
	});
}
function retrievePage() {
	$.get('wp-json/posts?type[]=page&filter[pagename]=about', function(data) {
		$('#viewer h1').text(data[0].title);
		$('#viewer div[data-role=content]').html(data[0].content);
		$.mobile.changePage("#viewer", "slide");
	});
}
function hideSplash() {
	$('#splash').hide();
	$.mobile.changePage("#home", "fade");
}
</script>
</body>
</html>
